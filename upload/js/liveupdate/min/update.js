var LiveUpdate={};
!function(b,d,c,e){LiveUpdate.SetupAutoPolling=function(){b("html").hasClass("LoggedIn")&&LiveUpdate.displayOptions&&(b(c).bind("XFAjaxSuccess",LiveUpdate.AjaxSuccess),LiveUpdate.AjaxSuccess(),setInterval(LiveUpdate.PollServer,LiveUpdate.pollInterval/2))};LiveUpdate.PollServer=function(){if(!LiveUpdate.xhr&&(new Date).getTime()-LiveUpdate.lastAjaxCompleted>LiveUpdate.pollInterval){var a=b(c).data("events").ajaxStart[0].handler;b(c).unbind("ajaxStart",a);LiveUpdate.xhr=XenForo.ajax("index.php?liveupdate",{},
function(){},{error:function(a,b,c){delete LiveUpdate.xhr;switch(b){case "timeout":console.warn(XenForo.phrases.server_did_not_respond_in_time_try_again);break;case "parsererror":console.error("PHP "+a.responseText)}return!1},timeout:LiveUpdate.pollInterval});b(c).bind("ajaxStart",a)}};LiveUpdate.AjaxSuccess=function(a){a=parseInt(b("#ConversationsMenu_Counter span.Total").text())+parseInt(b("#AlertsMenu_Counter span.Total").text());-1!==LiveUpdate.displayOptions.indexOf("tab_icon")&&LiveUpdate.favico.badge(a);
-1!==LiveUpdate.displayOptions.indexOf("tab_title")&&LiveUpdate.SetTabTitle(a);!a&&LiveUpdate.Notification&&LiveUpdate.Notification.close();LiveUpdate.lastAjaxCompleted=(new Date).getTime();delete LiveUpdate.xhr};LiveUpdate.pageTitleCache="";LiveUpdate.SetTabTitle=function(a){pageTitle=c.title;0==LiveUpdate.pageTitleCache.length&&(LiveUpdate.pageTitleCache=pageTitle);"("===pageTitle.charAt(0)&&(pageTitle=LiveUpdate.pageTitleCache);c.title=0<a?"("+a+") "+pageTitle:pageTitle};LiveUpdate.Notification=
null;LiveUpdate.SetupNotificationAPI=function(){LiveUpdate.Notification&&"denied"!==LiveUpdate.Notification.permission&&"granted"!==LiveUpdate.Notification.permission&&LiveUpdate.Notification.requestPermission(function(a){})};LiveUpdate.SendNotification=function(a){-1===LiveUpdate.displayOptions.indexOf("notifications_api")||-1!==navigator.userAgent.search(/\((iPhone|iPad|iPod);/)||LiveUpdate.Notification&&"granted"!==LiveUpdate.Notification.permission||(LiveUpdate.Notification=new Notification(LiveUpdate.boardTitle,
{body:a,icon:XenForo.baseUrl()+LiveUpdate.iconPath}))};b(c).ready(function(){LiveUpdate.SetupAutoPolling();LiveUpdate.SetupNotificationAPI()})}(jQuery,this,document);
