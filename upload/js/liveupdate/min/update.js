var LiveUpdate={};!function(e,t,a,i){LiveUpdate.boardTitle="",LiveUpdate.baseUrl="",LiveUpdate.iconPath="",LiveUpdate.SetupAutoPolling=function(){e("html").hasClass("LoggedIn")&&(LiveUpdate.displayType=e("html").data("displaytype"),LiveUpdate.displayType&&(LiveUpdate.pollInterval=1e3*e("html").data("pollinterval"),LiveUpdate.pollInterval||(LiveUpdate.pollInterval=1e4,e("html").data("pollinterval",10)),e(a).bind("XFAjaxSuccess",LiveUpdate.AjaxSuccess),LiveUpdate.AjaxSuccess(),setInterval(LiveUpdate.PollServer,LiveUpdate.pollInterval/2)))},LiveUpdate.PollServer=function(){if(!LiveUpdate.xhr&&(new Date).getTime()-LiveUpdate.lastAjaxCompleted>LiveUpdate.pollInterval){var t=e(a).data("events").ajaxStart[0].handler;e(a).unbind("ajaxStart",t),LiveUpdate.xhr=XenForo.ajax("index.php?liveupdate",{},function(){},{error:function(e,t,a){switch(delete LiveUpdate.xhr,t){case"timeout":console.warn(XenForo.phrases.server_did_not_respond_in_time_try_again);break;case"parsererror":console.error("PHP "+e.responseText)}return!1},timeout:LiveUpdate.pollInterval}),e(a).bind("ajaxStart",t)}},LiveUpdate.AjaxSuccess=function(t){var a=parseInt(e("#ConversationsMenu_Counter span.Total").text())+parseInt(e("#AlertsMenu_Counter span.Total").text());("both"==LiveUpdate.displayType||"tab_icon"==LiveUpdate.displayType)&&Tinycon.setBubble(a),("both"==LiveUpdate.displayType||"tab_title"==LiveUpdate.displayType)&&LiveUpdate.SetTabTitle(a),LiveUpdate.lastAjaxCompleted=(new Date).getTime(),delete LiveUpdate.xhr},pageTitleCache="",LiveUpdate.SetTabTitle=function(e){pageTitle=a.title,0==pageTitleCache.length&&(pageTitleCache=pageTitle),"("===pageTitle.charAt(0)&&(pageTitle=pageTitleCache),e>0?a.title="("+e+") "+pageTitle:a.title=pageTitle},LiveUpdate.SetupNotificationAPI=function(){"denied"!==Notification.permission&&"granted"!==Notification.permission&&Notification.requestPermission(function(e){})},LiveUpdate.SendNotification=function(e){if("granted"===Notification.permission){new Notification(LiveUpdate.boardTitle,{body:e,icon:LiveUpdate.baseUrl+"/"+LiveUpdate.iconPath})}},e(a).ready(function(){LiveUpdate.SetupAutoPolling(),LiveUpdate.SetupNotificationAPI()})}(jQuery,this,document);